<template>
  <div data-name="services">
        <div class="tab tab-active" id="tab-1">
            <div class="accordion-item accordion-item-opened padding-top">
                <div class="accordion-item-content">
                    <div data-pagination='{"el": ".swiper-pagination"}' class="swiper-container" id="emoji-poll-swiper">
                        <div class="swiper-pagination"></div>
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" id="card-sleep">
                                <div class="card">
                                    <div id="card-content-sleep" class="h100">
                                        <div class="card-question card-content card-content-padding">
                                            <p>Como tem sido a qualidade do seu sono nos últimos 7 dias?</p>
                                        </div>
                                        <div class="row padding">
                                            <div class="row">
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(0, 'sleep')" class="lottie"
                                                        src="https://assets5.lottiefiles.com/packages/lf20_pojzngga.json"></lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(1, 'sleep')" class="lottie"
                                                        src="https://assets7.lottiefiles.com/packages/lf20_21fbl4co.json">
                                                    </lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(2, 'sleep')" class="lottie"
                                                        src="https://assets1.lottiefiles.com/packages/lf20_s1u9tqu9.json">
                                                    </lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(3, 'sleep')" class="lottie"
                                                        src="https://assets2.lottiefiles.com/packages/lf20_xlbwcmun.json">
                                                    </lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(4, 'sleep')" class="lottie"
                                                        src="https://assets5.lottiefiles.com/packages/lf20_ivobmnxv.json">
                                                    </lottie-player>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
        
                            <div class="swiper-slide" id="card-food">
                                <div class="card">
                                    <div id="card-content-food" class="h100">
                                        <div class="card-question card-content card-content-padding">
                                            <p>Como tem sido a qualidade da sua alimentação nos últimos 7 dias?</p>
                                        </div>
                                        <div class="row padding">
                                            <div class="row">
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(0, 'food')" class="lottie"
                                                        src="https://assets5.lottiefiles.com/packages/lf20_pojzngga.json"></lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(1, 'food')" class="lottie"
                                                        src="https://assets7.lottiefiles.com/packages/lf20_21fbl4co.json">
                                                    </lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(2, 'food')" class="lottie"
                                                        src="https://assets1.lottiefiles.com/packages/lf20_s1u9tqu9.json">
                                                    </lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(3, 'food')" class="lottie"
                                                        src="https://assets2.lottiefiles.com/packages/lf20_xlbwcmun.json">
                                                    </lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(4, 'food')" class="lottie"
                                                        src="https://assets5.lottiefiles.com/packages/lf20_ivobmnxv.json">
                                                    </lottie-player>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
        
                            <div class="swiper-slide" id="card-happiness">
                                <div class="card">
                                    <div id="card-content-happiness" class="h100">
                                        <div class="card-question card-content card-content-padding">
                                            <p>Como você está se sentindo agora?</p>
                                        </div>
                                        <div class="row padding">
                                            <div class="row">
                                                <div class="col-20">
                                                    <lottie-player id="teste1" @click="pollLevel(0, 'hapiness')" class="lottie"
                                                        src="https://assets5.lottiefiles.com/packages/lf20_pojzngga.json"></lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(1, 'hapiness')" class="lottie"
                                                        src="https://assets7.lottiefiles.com/packages/lf20_21fbl4co.json">
                                                    </lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(2, 'hapiness')" class="lottie"
                                                        src="https://assets1.lottiefiles.com/packages/lf20_s1u9tqu9.json">
                                                    </lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(3, 'hapiness')" class="lottie"
                                                        src="https://assets2.lottiefiles.com/packages/lf20_xlbwcmun.json">
                                                    </lottie-player>
                                                </div>
                                                <div class="col-20">
                                                    <lottie-player @click="pollLevel(4, 'hapiness')" class="lottie"
                                                        src="https://assets5.lottiefiles.com/packages/lf20_ivobmnxv.json">
                                                    </lottie-player>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
        
                    <div data-pagination='{"el": ".swiper-pagination"}' class="swiper-container" id="button-poll-swiper">
                        <div class="swiper-pagination"></div>
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" id="card-physical-activity">
                                <div class="card">
                                    <div id="card-content-physical-activity" class="h100 card-content-padding">
                                        <div class="card-question card-content">
                                            Quantas vezes praticou atividade física nos últimos 7 dias?
                                        </div>
                            
                                        <div class="row margin-top">
                                            <button @click="pollLevel(0, 'physical-activity')" class="button col button-outline button-round">0</button>
                                            <button @click="pollLevel(1, 'physical-activity')" class="button col button-outline button-round">1</button>
                                            <button @click="pollLevel(2, 'physical-activity')" class="button col button-outline button-round">2</button>
                                            <button @click="pollLevel(3, 'physical-activity')" class="button col button-outline button-round">3</button>
                                            <button @click="pollLevel(4, 'physical-activity')" class="button col button-outline button-round">4</button>
                                            <button @click="pollLevel(5, 'physical-activity')" class="button col button-outline button-round">5+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
        
                            <div class="swiper-slide" id="card-leisure">
                                <div class="card padding-bottom">
                                    <div id="card-content-leisure" class="h100 card-content-padding">
                                        <div class="card-question card-content">
                                            Realizou atividades de lazer nos últimos 7 dias?
                                        </div>
                            
                                        <div class="row margin-top">
                                            <button @click="pollLevel(1, 'leisure')" class="button col button-outline button-round">Sim</button>
                                            <button @click="pollLevel(0, 'leisure')" class="button col button-outline button-round">Não</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item-toggle row justify-content-center f7-icons" style="width: 100%; font-size: 35px;" id="arrow_toggle">
                    chevron_compact_up
                </div>
            </div>

            <div class="menu-grid">
                <a href="/about-more/" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/ask-for-help.png" class="menu-grid__icon">
                        <div class="item-title">Transtornos mais comuns</div>
                    </div>
                </a>

                <a href="/prevention/" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/feeling-down.png" class="menu-grid__icon">
                        <div class="item-title">Principais sintomas</div>
                    </div>
                </a>

                <a href="/reasons/" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/feeling-blue.png" class="menu-grid__icon">
                        <div class="item-title">Fatores responsáveis</div>
                    </div>
                </a>

                <a href="/where-help/" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/know-yourself.png" class="menu-grid__icon">
                        <div class="item-title">Preconceitos e tabus</div>
                    </div>
                </a>

                <a href="/health-tips/" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/nourish-your-mind.png" class="menu-grid__icon">
                        <div class="item-title">Dicas</div>
                    </div>
                </a>

                <a href="/tips/sleep" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/sleep.png" class="menu-grid__icon">
                        <div class="item-title">Sono</div>
                    </div>
                </a>

                <a href="/tips/feeding" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/health-food.png" class="menu-grid__icon">
                        <div class="item-title">Dicas de Alimentação</div>
                    </div>
                </a>

                <a href="/tips/activity" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/exercise.png" class="menu-grid__icon">
                        <div class="item-title">Dicas de Atividade Física</div>
                    </div>
                </a>

                <a href="/tips/leisure" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/leisure.png" class="menu-grid__icon">
                        <div class="item-title">Dicas de Lazer</div>
                    </div>
                </a>
                
                <a href="/contact/" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/go-to-therapy.png" class="menu-grid__icon">
                        <div class="item-title">Atendimento Emergencial</div>
                    </div>
                </a>
            
                <a href="/wellness-quiz/" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/quiz.png" class="menu-grid__icon">
                        <div class="item-title">Questionário de Bem-Estar</div>
                    </div>
                </a>
            
                <a href="/hr/" class="menu-grid__item">
                    <div class="item-inner">
                        <img src="static/images/heartbeat.png" class="menu-grid__icon">
                        <div class="item-title">Batimento Cardíaco</div>
                    </div>
                </a>

            </div>
        </div>
    </div>
</template>
<script>
    import * as LottiePlayer from "@lottiefiles/lottie-player";

    export default {
        data: function () {
            return {
                emojiPollSwiper: null,
                buttonPollSwiper: null,
            }
        },
        methods: {
            swipersInit: async function(){
                var self = this;
                var app = self.$app;
                
                app.swiper.create('.swiper-container', {
                    pagination: {
                        el: '.swiper-pagination',
                        type: 'bullets',
                    },
                });
                await self.$setState({
                    emojiPollSwiper: app.swiper.get('#emoji-poll-swiper'),
                    buttonPollSwiper: app.swiper.get('#button-poll-swiper'),
                });
            },
            lottieInit: function(){
                var self = this;
                var app = self.$app;

                app.$$('.lottie').on('load', function (e) {
                    const player = e.target;
                    player.stop();
                    player.play();
                });

                app.$$('.lottie').on('click', async function (e) {
                    let emoji = e.target;
                    emoji.stop();
                    emoji.play();
                    app.$$(emoji).transition(1000);
                    await app.$$(emoji).transform('scale(1.3)');
                    setTimeout(() => {
                        app.$$(emoji).transform('scale(1)');
                    }, 2000);
                });
            },
            checkNeedQuestionnarie: function (type) {
                var self = this;
                var app = self.$app;

                var contentSlide;
                var itemHistory;

                switch (type) {
                    case "sleep":
                        contentSlide = app.$$("#card-sleep");
                        itemHistory = app.storage.getSleepHistory();
                        break;
                    case "food":
                        contentSlide = app.$$("#card-food");
                        itemHistory = app.storage.getFoodHistory();
                        break;
                    case "physical-activity":
                        contentSlide = app.$$("#card-physical-activity");
                        itemHistory = app.storage.getPhysicalActivityHistory();
                        break;
                    case "leisure":
                        contentSlide = app.$$("#card-leisure");
                        itemHistory = app.storage.getLeisureHistory();
                        break;
                    default:
                        console.log("error");
                }

                if (itemHistory == null) {
                    contentSlide.show();
                    return true;
                }

                let lastUpdateFromStorage = itemHistory.history[itemHistory.history.length - 1];
                let lastUpdate = new Date(lastUpdateFromStorage.created_at);
                let now = new Date();

                if (now.getFullYear() === lastUpdate.getFullYear() && now.getMonth() === lastUpdate.getMonth() && now.getDate() === lastUpdate.getDate()) {
                    contentSlide.hide();
                    return;
                } 
                contentSlide.show();
                return;
            },
            pollLevel: async function(answer, type){
                var self = this;
                var app = self.$app;
                
                var pollCard;
                var contentSlide;
                var timeout = 600;
                var animationTimeout = 3000;
                var hideContentSlide = true;

                switch(type){
                    case "sleep":
                        pollCard = app.$$("#card-content-sleep");
                        contentSlide = app.$$("#card-sleep");
                        app.storage.setSleepHistory(answer);
                        break;
                    case "food":
                        pollCard = app.$$("#card-content-food");
                        contentSlide = app.$$("#card-food");
                        app.storage.setFoodHistory(answer);
                        break;
                    case "hapiness":
                        pollCard = app.$$("#card-content-happiness");
                        contentSlide = app.$$("#card-happiness");
                        app.storage.setHappinessHistory(answer);
                        timeout = 30000;
                        hideContentSlide = false;
                        break;
                    case "physical-activity":
                        pollCard = app.$$("#card-content-physical-activity");
                        contentSlide = app.$$("#card-physical-activity");
                        app.storage.setPhysicalActivityHistory(answer);
                        animationTimeout = 0;
                        break;
                    case "leisure":
                        pollCard = app.$$("#card-content-leisure");
                        contentSlide = app.$$("#card-leisure");
                        app.storage.setLeisureHistory(answer);
                        animationTimeout = 0;
                        break;
                    default:
                        console.log("error");
                }

                contentSlide.css("pointer-events", "none");

                await new Promise(resolve => setTimeout(() => {
                    pollCard.animate(
                        {
                            'opacity': 0,
                        },
                        {
                            duration: 500,
                            easing: 'ease-in'
                        }
                    );
                    resolve();
                }, animationTimeout));

                setTimeout(() => {
                    pollCard.hide();
                    pollCard.css('opacity', '1');
                    app.dialog.alert('Obrigado por sua resposta :)');
                    contentSlide.css("pointer-events", "auto");
                }, 600);

                setTimeout(function () {
                    pollCard.show();
                    if(hideContentSlide){
                        contentSlide.hide();
                    }
                    self.emojiPollSwiper.update();
                    self.buttonPollSwiper.update();
                }, timeout);
            },
        },
        on: {
            tabInit: function(){
                var self = this;
                var app = self.$app;

                var types = ["sleep", "food", "physical-activity", "leisure"];

                for(let type of types){
                    this.checkNeedQuestionnarie(type);
                }

                app.$$('#arrow_toggle').click((e) => {
                    let accordion = app.$$('div.accordion-item');
                    let arrow = app.$$(e.target);
                    arrow.transition(600);

                    if(accordion.hasClass('accordion-item-opened')){
                        arrow.transform('rotateX(0deg)');
                    } else {
                        arrow.transform('rotateX(180deg)');
                    }
                })
            },
            tabMounted: function(){
                this.lottieInit();
                this.swipersInit();
            }
        }
    };
</script>
<style>
    .menu-grid {
        padding: 10px;
        display: grid;
        grid-template-columns: repeat(auto-fill, calc(50% - 5px));
        grid-gap: 10px;
    }

    .menu-grid__item {
        background-color: #f6f6f6;
        text-align: center;
        text-transform: uppercase;
        color: #1e2f42;
        font-weight: bold;
        padding: 10px;
    }

    .menu-grid__item.small {
        vertical-align: middle;
        font-weight: 400;
        padding: 8px;
        text-align: left;
        background-color: #dff1e0;
        font-size: 0.8em;
    }

    .menu-grid__item.small i {
        float: left;
        margin-top: 8px;
        margin-right: 10px;
        font-size: 1.8em;
    }

    .menu-grid__icon {
        height: 55px;
    }

    .card-question {
      font-size: 16px;
      font-weight: 500;
      text-align: justify;
    }
    
    .pa-fontsize{
        font-size:x-large;
    }

    .padding-10{
        padding: 10px;
    }

    .h100 {
        height: 100%;
    }

    .w100 {
        width: 100%;
    }

    .p-5px {
        padding: 5px;
    }

</style>
