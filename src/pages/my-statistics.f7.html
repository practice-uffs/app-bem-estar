<template>
    <div class="page" data-name="my-statistics">
        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="if-not-md">Voltar</span>
                    </a>
                </div>
                <div class="title">Minhas estatísticas</div>
            </div>
        </div>
        
        <div class="page-content" >
            <div class="padding-10" >
                <div class="card no-margin " >
                    <div class="card-header">
                        <p>Estatísticas sobre saúde alimentar</p>
                    </div>
                    <div class="card-content padding-10 display-flex align-content-center" >
                        <div class="row padding" >
                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_unhappy.svg" style="width: 100%;">
                            </div>

                            <div class="col-70" >
                                <div class="display-flex align-content-center">
                                    <div
                                        class="gauge gauge-init my-gauge-feeding"
                                        data-type="semicircle"
                                        data-value="0.44"
                                        data-value-text="44%"
                                        data-value-text-color="#ff9800"
                                        data-border-color="#ff9800"
                                    ></div>
                                </div>
                            </div>

                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_happy.svg" style="width: 100%;">
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>

            <div class="padding-10" >
                <div class="card no-margin " >
                    <div class="card-header">
                        <p>Estatísticas sobre lazer</p>
                    </div>
                    <div class="card-content padding-10 display-flex align-content-center" >
                        <div class="row padding" >
                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_unhappy.svg" style="width: 100%;">
                            </div>

                            <div class="col-70" >
                                <div class="display-flex align-content-center">
                                    <div
                                        class="gauge gauge-init my-gauge-leisure"
                                        data-type="semicircle"
                                        data-value="0.44"
                                        data-value-text="44%"
                                        data-value-text-color="#ff9800"
                                        data-border-color="#ff9800"
                                    ></div>
                                </div>
                            </div>

                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_happy.svg" style="width: 100%;">
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            

            <div class="padding-10" >
                <div class="card no-margin " >
                    <div class="card-header">
                        <p>Estatísticas sobre qualidade do sono</p>
                    </div>
                    <div class="card-content padding-10 display-flex align-content-center" >
                        <div class="row padding" >
                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_unhappy.svg" style="width: 100%;">
                            </div>

                            <div class="col-70" >
                                <div class="display-flex align-content-center">
                                    <div
                                        class="gauge gauge-init my-gauge-sleep"
                                        data-type="semicircle"
                                        data-value="0.44"
                                        data-value-text="44%"
                                        data-value-text-color="#ff9800"
                                        data-border-color="#ff9800"
                                    ></div>
                                </div>
                            </div>

                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_happy.svg" style="width: 100%;">
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            

            <div class="padding-10" >
                <div class="card no-margin " >
                    <div class="card-header">
                        <p>Estatísticas sobre atividades físicas</p>
                    </div>
                    <div class="card-content padding-10 display-flex align-content-center" >
                        <div class="row padding" >
                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_unhappy.svg" style="width: 100%;">
                            </div>

                            <div class="col-70" >
                                <div class="display-flex align-content-center">
                                    <div
                                        class="gauge gauge-init my-gauge-activity"
                                        data-type="semicircle"
                                        data-value="0.44"
                                        data-value-text="44%"
                                        data-value-text-color="#ff9800"
                                        data-border-color="#ff9800"
                                    ></div>
                                </div>
                            </div>

                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_happy.svg" style="width: 100%;">
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            
            <div class="padding-10" >
                <div class="card no-margin " >
                    <div class="card-header">
                        <p>Estatísticas sobre o nível do seu humor</p>
                    </div>
                    <div class="card-content padding-10 display-flex align-content-center" >
                        <div class="row padding" >
                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_unhappy.svg" style="width: 100%;">
                            </div>

                            <div class="col-70" >
                                <div class="display-flex align-content-center">
                                    <div
                                        class="gauge gauge-init my-gauge-happyness"
                                        data-type="semicircle"
                                        data-value="0.44"
                                        data-value-text="44%"
                                        data-value-text-color="#ff9800"
                                        data-border-color="#ff9800"
                                    ></div>
                                </div>
                            </div>

                            <div class="col-15 gauge-level" >
                                <img class="gauge-level-icon" src="static/images/affective-slider/AS_happy.svg" style="width: 100%;">
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="block block-strong no-padding">
                <div id="demo-calendar-inline-container"></div>
            </div>
        </div>

        

      
    </div>
</template>
<script>
    export default {
        methods: {
            loadData: function () {
               
            },
            updateGauges: function(){
                var self = this;
                var app = self.$app;

                var gaugeFeeding = app.gauge.get('.my-gauge-feeding');
                var gaugeLeisure = app.gauge.get('.my-gauge-leisure');
                var gaugeSleep = app.gauge.get('.my-gauge-sleep');
                var gaugeActivity = app.gauge.get('.my-gauge-activity');
                var gaugeHappyness = app.gauge.get('.my-gauge-happyness');
                
                gaugeFeeding.update({
                    value: this.getAverageInPercentage('feeding'),
                    valueText: (this.getAverageInPercentage('feeding')*100) + '%'
                });
                gaugeLeisure.update({
                    value: this.getAverageInPercentage('leisure'),
                    valueText: (this.getAverageInPercentage('leisure')*100) + '%'
                });
                gaugeSleep.update({
                    value: this.getAverageInPercentage('sleep'),
                    valueText: (this.getAverageInPercentage('sleep')*100) + '%'
                });
                gaugeActivity.update({
                    value: this.getAverageInPercentage('activity'),
                    valueText: (this.getAverageInPercentage('activity')*100) + '%'
                });
                gaugeHappyness.update({
                    value: this.getAverageInPercentage('happyness'),
                    valueText: (this.getAverageInPercentage('happyness')*100) + '%'
                });

            },
            getAverageInPercentage: function(type){
                var self = this;
                var app = self.$app;
                
                let history;
                let scaleMax;
                switch (type) {
                    case 'feeding':
                        scaleMax = 4;
                        history = app.storage.getFoodHistory();
                        break;
                    case 'leisure':
                        scaleMax = 1;
                        history = app.storage.getLeisureHistory();
                        break;
                    case 'sleep':
                        scaleMax = 4;
                        history = app.storage.getSleepHistory();    
                        break;
                    case 'activity':
                        scaleMax = 5;
                        history = app.storage.getPhysicalActivityHistory();    
                        break;
                    case 'happyness':
                        scaleMax = 4;
                        history = app.storage.getHappinessHistory();    
                        break;
                }         
                let average = 0;
                if(history != null){
                    history.history.forEach(element => {
                        average = average + element.awnser;
                    }); 
                    average = average/history.history.length;
                    let percentage = average/scaleMax;
                    return percentage.toFixed(2);
                } else {
                    return 0;
                }
                
            },
            calendar: function () {
                let self = this;
                let app = self.$app;
                var $$ = Dom7;
                var monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto' , 'Setembro' , 'Outubro', 'Novembro', 'Dezembro'];
                var calendarInline = app.calendar.create({
                    containerEl: '#demo-calendar-inline-container',
                    value: [new Date()],
                    weekHeader: false,
                    renderToolbar: function () {
                        return '<div class="toolbar calendar-custom-toolbar no-shadow">' +
                        '<div class="toolbar-inner">' +
                            '<div class="left">' +
                            '<a href="#" class="link icon-only"><i class="icon icon-back ' + (app.theme === 'md' ? 'color-black' : '') + '"></i></a>' +
                            '</div>' +
                            '<div class="center"></div>' +
                            '<div class="right">' +
                            '<a href="#" class="link icon-only"><i class="icon icon-forward ' + (app.theme === 'md' ? 'color-black' : '') + '"></i></a>' +
                            '</div>' +
                        '</div>' +
                        '</div>';
                    },
                    
                    on: {
                        init: function (c) {
                            $$('.calendar-custom-toolbar .center').text(monthNames[c.currentMonth] +', ' + c.currentYear);
                            $$('.calendar-custom-toolbar .left .link').on('click', function () {
                                calendarInline.prevMonth();
                            });
                            $$('.calendar-custom-toolbar .right .link').on('click', function () {
                                calendarInline.nextMonth();
                            });                        
                        },
                        monthYearChangeStart: function (c) {
                            $$('.calendar-custom-toolbar .center').text(monthNames[c.currentMonth] +', ' + c.currentYear);
                        }
                    }
                });
            },
        },
        on: {
            pageAfterin: function (e, page) {
                this.updateGauges();
                this.calendar();
            },
            
        },
    };
</script>

<style>
    .h100{
        height: 100%;
    }
    .gauge-level{
        display: flex;
        height: 100%;
    }
    .gauge-level-icon{
        display: inline-block;
        align-self: flex-end;
    }
</style>
